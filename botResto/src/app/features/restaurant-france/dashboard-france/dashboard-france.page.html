<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Tableau de bord</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        <ion-icon name="log-out" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Accueil Restaurant -->
  <div class="welcome-section">
    <div class="restaurant-info">
      <ion-icon name="restaurant" class="restaurant-icon"></ion-icon>
      <div class="info-text">
        <h2>Bienvenue {{ currentUser?.name }}</h2>
        <p>Tableau de bord restaurant France</p>
      </div>
    </div>
  </div>

  <!-- Statistiques rapides -->
  <div class="stats-section">
    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-content">
                <ion-icon name="receipt" class="stat-icon"></ion-icon>
                <div class="stat-text">
                  <h3>{{ todayOrders }}</h3>
                  <p>Commandes aujourd'hui</p>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        
        <ion-col size="6">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-content">
                <ion-icon name="time" class="stat-icon pending"></ion-icon>
                <div class="stat-text">
                  <h3>{{ pendingOrders }}</h3>
                  <p>En attente</p>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
      
      <ion-row>
        <ion-col size="6">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-content">
                <ion-icon name="bicycle" class="stat-icon success"></ion-icon>
                <div class="stat-text">
                  <h3>{{ activeDrivers }}</h3>
                  <p>Livreurs actifs</p>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        
        <ion-col size="6">
          <ion-card class="stat-card">
            <ion-card-content>
              <div class="stat-content">
                <ion-icon name="cash" class="stat-icon tertiary"></ion-icon>
                <div class="stat-text">
                  <h3>{{ todayRevenue }}‚Ç¨</h3>
                  <p>CA aujourd'hui</p>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- Actions rapides -->
  <div class="actions-section">
    <h3>Actions rapides</h3>
    
    <ion-list class="action-list">
      <ion-item button (click)="goToOrders()" class="action-item">
        <ion-icon name="list" slot="start" class="action-icon primary"></ion-icon>
        <ion-label>
          <h4>G√©rer les commandes</h4>
          <p>Voir et traiter les commandes en cours</p>
        </ion-label>
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
      </ion-item>

      <ion-item button (click)="goToDrivers()" class="action-item">
        <ion-icon name="bicycle" slot="start" class="action-icon secondary"></ion-icon>
        <ion-label>
          <h4>G√©rer les livreurs</h4>
          <p>Voir les livreurs et leurs statuts</p>
        </ion-label>
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
      </ion-item>

      <ion-item button (click)="goToDeliveryTracking()" class="action-item">
        <ion-icon name="location" slot="start" class="action-icon warning"></ion-icon>
        <ion-label>
          <h4>Suivi des livraisons</h4>
          <p>Tracker les commandes et notifications livreurs</p>
        </ion-label>
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
      </ion-item>

      <ion-item button (click)="viewStats()" class="action-item">
        <ion-icon name="bar-chart" slot="start" class="action-icon success"></ion-icon>
        <ion-label>
          <h4>Statistiques</h4>
          <p>Consulter les performances du restaurant</p>
        </ion-label>
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
      </ion-item>

      <ion-item button (click)="goToSettings()" class="action-item">
        <ion-icon name="settings" slot="start" class="action-icon tertiary"></ion-icon>
        <ion-label>
          <h4>Configuration Restaurant</h4>
          <p>Horaires, produits, workflows et livraison</p>
        </ion-label>
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
      </ion-item>
    </ion-list>
  </div>

  <!-- NOUVEAU : Section Renouvellement Abonnement -->
  <div class="renewal-section" *ngIf="stripeConfig">
    <h3>üí≥ Renouveler mon Abonnement</h3>

    <ion-grid>
      <ion-row>
        <!-- Plan Mensuel -->
        <ion-col size="12" sizeMd="4">
          <ion-card class="plan-card">
            <ion-card-header>
              <ion-card-title>üìÖ Mensuel</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="price">{{ stripeConfig.amount_monthly }}‚Ç¨<span>/mois</span></div>
              <ion-button expand="block" (click)="renewSubscription('monthly')" [disabled]="isCreatingCheckout">
                Renouveler 1 mois
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <!-- Plan Trimestriel -->
        <ion-col size="12" sizeMd="4">
          <ion-card class="plan-card popular">
            <ion-badge color="warning" class="badge-popular">‚≠ê POPULAIRE</ion-badge>
            <ion-card-header>
              <ion-card-title>üìÖ Trimestriel</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="price">{{ stripeConfig.amount_quarterly }}‚Ç¨<span>/3 mois</span></div>
              <p class="savings">√âconomisez 14%</p>
              <ion-button expand="block" color="warning" (click)="renewSubscription('quarterly')" [disabled]="isCreatingCheckout">
                Renouveler 3 mois
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <!-- Plan Annuel -->
        <ion-col size="12" sizeMd="4">
          <ion-card class="plan-card">
            <ion-card-header>
              <ion-card-title>üìÖ Annuel</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="price">{{ stripeConfig.amount_annual }}‚Ç¨<span>/an</span></div>
              <p class="savings">√âconomisez 29%</p>
              <ion-button expand="block" (click)="renewSubscription('annual')" [disabled]="isCreatingCheckout">
                Renouveler 12 mois
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- Commandes r√©centes dans un accord√©on -->
  <div class="recent-orders-section" *ngIf="recentOrders.length > 0">
    <ion-accordion-group>
      <ion-accordion value="recent-orders">
        <ion-item slot="header" color="light">
          <ion-icon name="receipt-outline" slot="start"></ion-icon>
          <ion-label>
            <h3>Commandes r√©centes</h3>
            <p>{{ recentOrders.length }} commande(s)</p>
          </ion-label>
        </ion-item>
        
        <div slot="content" class="accordion-content">
          <ion-card *ngFor="let order of recentOrders" class="order-card">
            <ion-card-content>
              <div class="order-header">
                <div class="order-info">
                  <h4>#{{ order.order_number }}</h4>
                  <p>{{ order.phone_number }} ‚Ä¢ {{ formatTime(order.created_at) }}</p>
                </div>
                <ion-badge [color]="getStatusColor(order.status)">
                  {{ getStatusText(order.status) }}
                </ion-badge>
              </div>
              
              <div class="order-details">
                <p><strong>Total:</strong> {{ formatPrice(order.total_amount) }}</p>
                <p><strong>Mode:</strong> {{ getDeliveryModeText(order.delivery_mode) }}</p>
              </div>
            </ion-card-content>
          </ion-card>
        </div>
      </ion-accordion>
    </ion-accordion-group>
  </div>

  <!-- Message si pas de commandes -->
  <div class="no-orders-section" *ngIf="recentOrders.length === 0 && !isLoading">
    <ion-card>
      <ion-card-content class="text-center">
        <ion-icon name="receipt-outline" class="no-orders-icon"></ion-icon>
        <h3>Aucune commande r√©cente</h3>
        <p>Les nouvelles commandes appara√Ætront ici</p>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Loading -->
  <div class="loading-section" *ngIf="isLoading">
    <ion-card>
      <ion-card-content class="text-center">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Chargement des donn√©es...</p>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>