<!-- FORMULAIRE COMPLET AVEC HTML STANDARD - COPIE EXACTE DE add-driver-modal -->
<div style="width: 100%; height: 100%; background: #f8f9fa; padding: 0; display: flex; flex-direction: column;">

  <!-- En-tête -->
  <div style="background: #6c5ce7; color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 18px;">
    <span style="position: absolute; left: 15px; cursor: pointer; font-size: 22px;" (click)="dismiss()">✕</span>
    📱 Inviter un client
  </div>

  <!-- Message d'erreur si formulaire non initialisé -->
  <div *ngIf="!inviteForm" style="padding: 40px; text-align: center;">
    <div style="background: #ff6b6b; color: white; padding: 20px; border-radius: 12px;">
      <h3>❌ Erreur d'initialisation</h3>
      <p>Le formulaire ne s'est pas chargé correctement.</p>
      <button (click)="dismiss()" style="background: white; color: #ff6b6b; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
        Fermer
      </button>
    </div>
  </div>

  <!-- Contenu du formulaire -->
  <div style="flex: 1; overflow-y: auto; padding: 15px;" *ngIf="inviteForm">
    <form [formGroup]="inviteForm" (ngSubmit)="save()" style="max-width: 500px; margin: 0 auto;">

      <!-- Section Contact -->
      <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h3 style="margin: 0 0 15px 0; color: #2d3436; display: flex; align-items: center; gap: 8px; font-size: 16px;">
          <span style="color: #6c5ce7;">📞</span> Contact du client
        </h3>

        <!-- Sélecteur de pays -->
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #2d3436; font-size: 14px;">
            🌍 Pays <span style="color: #e17055;">*</span>
          </label>
          <select
            formControlName="country_code_selector"
            (change)="onCountryChange()"
            style="width: 100%; padding: 10px; border: 2px solid #6c5ce7; border-radius: 6px; font-size: 14px; box-sizing: border-box; cursor: pointer; background: white;"
            [style.border-color]="hasError('country_code_selector') ? '#e17055' : '#6c5ce7'">
            <option *ngFor="let country of availableCountries" [value]="country.code">
              {{country.flag}} {{country.name}} (+{{country.code}})
            </option>
          </select>
        </div>

        <!-- Téléphone local -->
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #2d3436; font-size: 14px;">
            📱 Numéro de téléphone <span style="color: #e17055;">*</span>
          </label>
          <input
            type="tel"
            formControlName="phone_number"
            placeholder="Ex: 0612345678 ou 620123456"
            maxlength="15"
            (input)="onPhoneInput($event)"
            style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;"
            [style.border-color]="hasError('phone_number') ? '#e17055' : '#ddd'"
            (focus)="$event.target.style.borderColor='#6c5ce7'"
            (blur)="$event.target.style.borderColor = hasError('phone_number') ? '#e17055' : '#ddd'">

          <!-- Numéro final formaté -->
          <div *ngIf="!hasError('phone_number') && getFinalPhoneNumber()" style="margin-top: 8px; padding: 8px; background: #d1f2eb; border-radius: 6px; border-left: 4px solid #00b894;">
            <p style="margin: 0; color: #00b894; font-size: 13px; font-weight: 600;">
              ✅ Numéro final : {{getFinalPhoneNumber()}}
            </p>
          </div>

          <div *ngIf="hasError('phone_number')" style="color: #e17055; font-size: 12px; margin-top: 4px;">
            {{getErrorMessage('phone_number')}}
          </div>
        </div>

      </div>

      <!-- Section Lien WhatsApp -->
      <div style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div style="display: flex; align-items: center; gap: 12px; padding: 10px; background: rgba(108, 92, 231, 0.1); border-radius: 8px; border-left: 4px solid #6c5ce7;">
          <span style="font-size: 20px;">📲</span>
          <div style="flex: 1;">
            <p style="margin: 0; font-weight: 600; color: #2d3436; font-size: 14px;">Lien copié automatiquement</p>
            <p style="margin: 0; font-size: 12px; color: #636e72;">À envoyer au client via WhatsApp</p>
          </div>
        </div>
      </div>

    </form>
  </div>

<!-- Boutons de pied de page - TOUJOURS VISIBLES -->
<div style="background: white; padding: 15px; border-top: 1px solid #ddd; flex-shrink: 0;">
  <div style="display: flex; gap: 12px; max-width: 500px; margin: 0 auto;">
    <button
      type="button"
      (click)="dismiss()"
      style="flex: 1; padding: 12px; background: #636e72; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">
      Annuler
    </button>
    <button
      type="button"
      (click)="save()"
      [disabled]="!inviteForm?.valid"
      style="flex: 2; padding: 12px; background: #00b894; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(0, 184, 148, 0.3);"
      [style.opacity]="!inviteForm?.valid ? '0.6' : '1'">
      📤 Envoyer l'invitation WhatsApp
    </button>
  </div>
</div>

</div>
