<div class="service-modes-container">
  <ion-card>
    <ion-card-header>
      <ion-card-title color="primary">
        <ion-icon name="settings" slot="start"></ion-icon>
        Modes de Service
      </ion-card-title>
      <ion-card-subtitle>
        Configurez les modes de service disponibles pour votre restaurant
      </ion-card-subtitle>
    </ion-card-header>
  </ion-card>

  <div class="modes-grid">
    <ion-card *ngFor="let mode of serviceModes" class="mode-card" [class.disabled]="!mode.is_enabled">
      <ion-card-header>
        <div class="mode-header">
          <div class="mode-info">
            <ion-icon [name]="getModeIcon(mode.service_mode)" [color]="getModeColor(mode.service_mode)" size="large"></ion-icon>
            <div class="mode-details">
              <h3>{{ mode.display_name }}</h3>
              <p *ngIf="mode.description">{{ mode.description }}</p>
            </div>
          </div>
          
          <div class="mode-status">
            <ion-badge [color]="mode.is_enabled ? 'success' : 'medium'">
              {{ mode.is_enabled ? 'Actif' : 'Inactif' }}
            </ion-badge>
          </div>
        </div>
      </ion-card-header>

      <ion-card-content>
        <div class="mode-actions">
          <ion-button 
            fill="clear" 
            [color]="mode.is_enabled ? 'danger' : 'success'"
            (click)="toggleMode(mode)">
            <ion-icon [name]="mode.is_enabled ? 'pause-circle' : 'play-circle'" slot="start"></ion-icon>
            {{ mode.is_enabled ? 'D√©sactiver' : 'Activer' }}
          </ion-button>

          <ion-button 
            fill="clear" 
            color="primary"
            (click)="editModeDetails(mode)">
            <ion-icon name="create" slot="start"></ion-icon>
            Modifier
          </ion-button>
        </div>

        <!-- Mode sp√©cifique: Livraison -->
        <div *ngIf="mode.service_mode === 'livraison' && mode.is_enabled" class="delivery-specific">
          <ion-item>
            <ion-icon name="car" slot="start" color="success"></ion-icon>
            <ion-label>
              <h3>Configuration livraison</h3>
              <div class="delivery-zone-inline">
                <span class="label">Zone de livraison:</span>
                <ion-input
                  *ngIf="isEditingDeliveryZone; else displayZone"
                  [(ngModel)]="tempDeliveryZoneKm"
                  type="number"
                  min="1"
                  max="50"
                  class="inline-input"
                  (ionBlur)="saveDeliveryZone()"
                  (keyup.enter)="saveDeliveryZone()"
                  (keyup.escape)="cancelEditDeliveryZone()">
                </ion-input>
                <ng-template #displayZone>
                  <span class="zone-value" (click)="startEditDeliveryZone()">{{ deliveryZoneKm }}km</span>
                </ng-template>
              </div>
            </ion-label>
          </ion-item>

        </div>

        <!-- Mode sp√©cifique: Sur place -->
        <div *ngIf="mode.service_mode === 'sur_place' && mode.is_enabled" class="dine-in-specific">
          <ion-item>
            <ion-icon name="restaurant" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>R√©servation de table</h3>
              <p>Gestion des r√©servations et capacit√©</p>
            </ion-label>
          </ion-item>
        </div>

        <!-- Mode sp√©cifique: √Ä emporter -->
        <div *ngIf="mode.service_mode === 'a_emporter' && mode.is_enabled" class="takeaway-specific">
          <ion-item>
            <ion-icon name="time" slot="start" color="warning"></ion-icon>
            <ion-label>
              <h3>Temps de pr√©paration</h3>
              <p>Estimation du temps de pr√©paration moyen</p>
            </ion-label>
            <ion-note slot="end">15-20 min</ion-note>
          </ion-item>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- NOUVEAU: Configuration Mode d'Adresse Livraison -->
  <ion-card *ngIf="hasDeliveryMode()" class="delivery-address-config-card">
    <ion-card-header>
      <ion-card-title color="tertiary">
        <ion-icon name="location" slot="start"></ion-icon>
        Mode de Collecte d'Adresse
      </ion-card-title>
      <ion-card-subtitle>
        Configurez comment les clients partagent leur adresse de livraison
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-item>
        <ion-label>
          <h3>Type de collecte d'adresse</h3>
          <p>Choisissez la m√©thode adapt√©e √† votre zone g√©ographique</p>
        </ion-label>
        <ion-select
          [(ngModel)]="deliveryAddressMode"
          interface="popover"
          (ionChange)="updateDeliveryAddressMode()">
          <ion-select-option value="address">
            üìù Saisie textuelle (France/Europe)
          </ion-select-option>
          <ion-select-option value="geolocation">
            üìç Partage GPS (Guin√©e/Afrique)
          </ion-select-option>
        </ion-select>
      </ion-item>

      <div class="address-mode-description" [ngSwitch]="deliveryAddressMode">
        <div *ngSwitchCase="'address'" class="mode-description text-mode">
          <ion-icon name="create" color="primary"></ion-icon>
          <span>Les clients saisissent leur adresse compl√®te (ex: 12 rue de la Paix, Paris)</span>
        </div>
        <div *ngSwitchCase="'geolocation'" class="mode-description gps-mode">
          <ion-icon name="navigate" color="success"></ion-icon>
          <span>Les clients partagent leur position GPS via WhatsApp</span>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Instructions -->
  <ion-card class="info-card">
    <ion-card-content>
      <div class="info-content">
        <ion-icon name="information-circle" color="primary"></ion-icon>
        <div>
          <h4>Information importante</h4>
          <p>
            Les modes d√©sactiv√©s ne seront pas propos√©s aux clients dans le bot WhatsApp. 
            Au moins un mode doit rester actif pour que le restaurant soit fonctionnel.
          </p>
        </div>
      </div>
    </ion-card-content>
  </ion-card>
</div>