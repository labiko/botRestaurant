<div class="options-management-container">
  <div class="page-header">
    <h2>üè™ Gestion Centralis√©e des Options</h2>
    <p>G√©rez toutes les options (viandes, sauces, suppl√©ments) en un seul endroit</p>
  </div>

  <!-- Navigation par tabs -->
  <div class="tabs-navigation">
    <!-- üÜï Segments dynamiques bas√©s sur les vraies donn√©es -->
    <ion-segment [(ngModel)]="activeTab" [ngModelOptions]="{standalone: true}" (ionChange)="switchTab($event.detail.value)" scrollable *ngIf="dynamicGroups.length > 0">
      <ion-segment-button *ngFor="let group of dynamicGroups" [value]="group">
        <ion-label>
          {{ getGroupIcon(group) }} {{ getGroupDisplayName(group) }}
          ({{ groupCounts[group] || 0 }})
        </ion-label>
      </ion-segment-button>
    </ion-segment>

    <!-- üîÑ Fallback vers l'ancien syst√®me si pas de groupes dynamiques -->
    <ion-segment [(ngModel)]="activeTab" [ngModelOptions]="{standalone: true}" (ionChange)="switchTab($event.detail.value)" scrollable *ngIf="dynamicGroups.length === 0">
      <ion-segment-button value="meats">
        <ion-label>ü•© Viandes ({{ meatOptions.length }})</ion-label>
      </ion-segment-button>
      <ion-segment-button value="sauces">
        <ion-label>üå∂Ô∏è Sauces ({{ sauceOptions.length }})</ion-label>
      </ion-segment-button>
      <ion-segment-button value="supplements">
        <ion-label>üßÄ Suppl√©ments ({{ supplementOptions.length }})</ion-label>
      </ion-segment-button>
      <ion-segment-button value="beverages">
        <ion-label>ü•§ Boissons ({{ beverageOptions.length }})</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- üÜï Section Dynamique pour tous les groupes r√©els -->
  <ion-card class="option-group-card" *ngFor="let group of dynamicGroups" [style.display]="activeTab === group ? 'block' : 'none'">
    <ion-card-header>
      <div class="group-header">
        <ion-card-title color="primary">
          <ion-icon name="options" slot="start"></ion-icon>
          {{ getGroupIcon(group) }} {{ getGroupDisplayName(group) }}
        </ion-card-title>
        <div class="stats">{{ groupCounts[group] || 0 }} options ‚Ä¢ {{ getDynamicGroupActiveCount(group) }} actives</div>
      </div>
    </ion-card-header>
    <ion-card-content>
      <div class="options-grid" *ngIf="getDynamicGroupOptions(group).length > 0">
        <div *ngFor="let option of getDynamicGroupOptions(group); let i = index" class="option-item">
          <div class="option-info">
            <div class="option-name-container">
              <h4 *ngIf="!option.isEditing" (click)="startEditing(option)" class="editable-name">
                {{ option.name }}
                <ion-icon name="create-outline" class="edit-icon"></ion-icon>
              </h4>
              <ion-input
                *ngIf="option.isEditing"
                [(ngModel)]="option.name"
                (keyup.enter)="saveOptionName(option)"
                (ionBlur)="saveOptionName(option)"
                #editInput
                class="editing-input">
              </ion-input>
            </div>
            <p class="option-details">
              {{ option.price_modifier > 0 ? '+' + option.price_modifier + '‚Ç¨' : 'Inclus' }} ‚Ä¢
              <span *ngIf="option.productDetails && option.productDetails.length > 0; else oldFormat">
                {{ option.productDetails[0].productName }} ({{ option.productDetails[0].categoryName }})
                <span *ngIf="option.productDetails.length > 1"> +{{ option.productDetails.length - 1 }}</span>
              </span>
              <ng-template #oldFormat>
                Utilis√© dans {{ option.affectedProducts }} produit(s)
              </ng-template>
            </p>
          </div>
          <div class="option-actions">
            <ion-toggle
              [checked]="option.is_active"
              (ionChange)="onOptionToggle(option, $event)"
              color="success">
            </ion-toggle>
            <ion-button fill="clear" color="danger" size="small" (click)="deleteOption(option)">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Bouton Ajouter supprim√© pour √©viter les options orphelines -->
      <div *ngIf="getDynamicGroupOptions(group).length === 0" class="empty-state">
        <ion-icon name="document" color="medium"></ion-icon>
        <p>Aucune option configur√©e dans {{ getGroupDisplayName(group).toLowerCase() }}</p>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- üîÑ Sections statiques existantes (fallback) -->

  <!-- Section Viandes -->
  <ion-card class="option-group-card" *ngIf="activeTab === 'meats'">
    <ion-card-header>
      <div class="group-header">
        <ion-card-title color="danger">
          <ion-icon name="nutrition" slot="start"></ion-icon>
          ü•© VIANDES
        </ion-card-title>
        <div class="stats">{{ meatOptions.length }} options ‚Ä¢ {{ getActiveCount(meatOptions) }} actives</div>
      </div>
    </ion-card-header>
    <ion-card-content>
      <div class="options-grid" *ngIf="meatOptions.length > 0">
        <div *ngFor="let option of meatOptions; let i = index" class="option-item">
          <div class="option-info">
            <div class="option-name-container">
              <h4 *ngIf="!option.isEditing" (click)="startEditing(option)" class="editable-name">
                {{ option.name }}
                <ion-icon name="create-outline" class="edit-icon"></ion-icon>
              </h4>
              <ion-input
                *ngIf="option.isEditing"
                [(ngModel)]="option.name"
                (keyup.enter)="saveOptionName(option)"
                (ionBlur)="saveOptionName(option)"
                #editInput
                class="editing-input">
              </ion-input>
            </div>
            <p class="option-details">
              {{ option.price_modifier > 0 ? '+' + option.price_modifier + '‚Ç¨' : 'Inclus' }} ‚Ä¢
              <span *ngIf="option.productDetails && option.productDetails.length > 0; else oldFormat">
                {{ option.productDetails[0].productName }} ({{ option.productDetails[0].categoryName }})
                <span *ngIf="option.productDetails.length > 1"> +{{ option.productDetails.length - 1 }}</span>
              </span>
              <ng-template #oldFormat>
                Utilis√© dans {{ option.affectedProducts }} produit(s)
              </ng-template>
            </p>
          </div>
          <div class="option-actions">
            <ion-toggle
              [checked]="option.is_active"
              (ionChange)="onOptionToggle(option, $event)"
              color="success">
            </ion-toggle>
            <ion-button fill="clear" color="danger" size="small" (click)="deleteOption(option)">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Bouton Ajouter supprim√© pour √©viter les options orphelines -->
      <div *ngIf="meatOptions.length === 0" class="empty-state">
        <ion-icon name="restaurant" color="medium"></ion-icon>
        <p>Aucune viande configur√©e</p>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Section Sauces -->
  <ion-card class="option-group-card" *ngIf="activeTab === 'sauces'">
    <ion-card-header>
      <div class="group-header">
        <ion-card-title color="warning">
          <ion-icon name="water" slot="start"></ion-icon>
          üå∂Ô∏è SAUCES
        </ion-card-title>
        <div class="stats">{{ sauceOptions.length }} options ‚Ä¢ {{ getActiveCount(sauceOptions) }} actives</div>
      </div>
    </ion-card-header>
    <ion-card-content>
      <div class="options-grid" *ngIf="sauceOptions.length > 0">
        <div *ngFor="let option of sauceOptions; let i = index" class="option-item">
          <div class="option-info">
            <div class="option-name-container">
              <h4 *ngIf="!option.isEditing" (click)="startEditing(option)" class="editable-name">
                {{ option.name }}
                <ion-icon name="create-outline" class="edit-icon"></ion-icon>
              </h4>
              <ion-input
                *ngIf="option.isEditing"
                [(ngModel)]="option.name"
                (keyup.enter)="saveOptionName(option)"
                (ionBlur)="saveOptionName(option)"
                #editInput
                class="editing-input">
              </ion-input>
            </div>
            <p class="option-details">
              {{ option.price_modifier > 0 ? '+' + option.price_modifier + '‚Ç¨' : 'Gratuit' }} ‚Ä¢
              <span *ngIf="option.productDetails && option.productDetails.length > 0; else oldFormat">
                {{ option.productDetails[0].productName }} ({{ option.productDetails[0].categoryName }})
                <span *ngIf="option.productDetails.length > 1"> +{{ option.productDetails.length - 1 }}</span>
              </span>
              <ng-template #oldFormat>
                Utilis√© dans {{ option.affectedProducts }} produit(s)
              </ng-template>
            </p>
          </div>
          <div class="option-actions">
            <ion-toggle
              [checked]="option.is_active"
              (ionChange)="onOptionToggle(option, $event)"
              color="success">
            </ion-toggle>
            <ion-button fill="clear" color="danger" size="small" (click)="deleteOption(option)">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Bouton Ajouter supprim√© pour √©viter les options orphelines -->
      <div *ngIf="sauceOptions.length === 0" class="empty-state">
        <ion-icon name="water" color="medium"></ion-icon>
        <p>Aucune sauce configur√©e</p>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Section Suppl√©ments -->
  <ion-card class="option-group-card" *ngIf="activeTab === 'supplements'">
    <ion-card-header>
      <div class="group-header">
        <ion-card-title color="secondary">
          <ion-icon name="add-circle" slot="start"></ion-icon>
          üßÄ SUPPL√âMENTS
        </ion-card-title>
        <div class="stats">{{ supplementOptions.length }} options ‚Ä¢ {{ getActiveCount(supplementOptions) }} actives</div>
      </div>
    </ion-card-header>
    <ion-card-content>
      <div class="options-grid" *ngIf="supplementOptions.length > 0">
        <div *ngFor="let option of supplementOptions; let i = index" class="option-item">
          <div class="option-info">
            <div class="option-name-container">
              <h4 *ngIf="!option.isEditing" (click)="startEditing(option)" class="editable-name">
                {{ option.name }}
                <ion-icon name="create-outline" class="edit-icon"></ion-icon>
              </h4>
              <ion-input
                *ngIf="option.isEditing"
                [(ngModel)]="option.name"
                (keyup.enter)="saveOptionName(option)"
                (ionBlur)="saveOptionName(option)"
                #editInput
                class="editing-input">
              </ion-input>
            </div>
            <p class="option-details">
              {{ option.price_modifier > 0 ? '+' + option.price_modifier + '‚Ç¨' : 'Inclus' }} ‚Ä¢
              <span *ngIf="option.productDetails && option.productDetails.length > 0; else oldFormat">
                {{ option.productDetails[0].productName }} ({{ option.productDetails[0].categoryName }})
                <span *ngIf="option.productDetails.length > 1"> +{{ option.productDetails.length - 1 }}</span>
              </span>
              <ng-template #oldFormat>
                Utilis√© dans {{ option.affectedProducts }} produit(s)
              </ng-template>
            </p>
          </div>
          <div class="option-actions">
            <ion-toggle
              [checked]="option.is_active"
              (ionChange)="onOptionToggle(option, $event)"
              color="success">
            </ion-toggle>
            <ion-button fill="clear" color="danger" size="small" (click)="deleteOption(option)">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Bouton Ajouter supprim√© pour √©viter les options orphelines -->
      <div *ngIf="supplementOptions.length === 0" class="empty-state">
        <ion-icon name="add-circle" color="medium"></ion-icon>
        <p>Aucun suppl√©ment configur√©</p>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Section Boissons -->
  <ion-card class="option-group-card" *ngIf="activeTab === 'beverages'">
    <ion-card-header>
      <div class="group-header">
        <ion-card-title color="primary">
          <ion-icon name="wine" slot="start"></ion-icon>
          ü•§ BOISSONS
        </ion-card-title>
        <div class="stats">{{ beverageOptions.length }} options ‚Ä¢ {{ getActiveCount(beverageOptions) }} actives</div>
      </div>
    </ion-card-header>
    <ion-card-content>
      <div class="options-grid" *ngIf="beverageOptions.length > 0">
        <div *ngFor="let option of beverageOptions; let i = index" class="option-item">
          <div class="option-info">
            <div class="option-name-container">
              <h4 *ngIf="!option.isEditing" (click)="startEditing(option)" class="editable-name">
                {{ option.name }}
                <ion-icon name="create-outline" class="edit-icon"></ion-icon>
              </h4>
              <ion-input
                *ngIf="option.isEditing"
                [(ngModel)]="option.name"
                (keyup.enter)="saveOptionName(option)"
                (ionBlur)="saveOptionName(option)"
                #editInput
                class="editing-input">
              </ion-input>
            </div>
            <p class="option-details">
              {{ option.price_modifier > 0 ? '+' + option.price_modifier + '‚Ç¨' : 'Inclus' }} ‚Ä¢
              <span *ngIf="option.productDetails && option.productDetails.length > 0; else oldFormat">
                {{ option.productDetails[0].productName }} ({{ option.productDetails[0].categoryName }})
                <span *ngIf="option.productDetails.length > 1"> +{{ option.productDetails.length - 1 }}</span>
              </span>
              <ng-template #oldFormat>
                Utilis√© dans {{ option.affectedProducts }} produit(s)
              </ng-template>
            </p>
          </div>
          <div class="option-actions">
            <ion-toggle
              [checked]="option.is_active"
              (ionChange)="onOptionToggle(option, $event)"
              color="success">
            </ion-toggle>
            <ion-button fill="clear" color="danger" size="small" (click)="deleteOption(option)">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Bouton Ajouter supprim√© pour √©viter les options orphelines -->
      <div *ngIf="beverageOptions.length === 0" class="empty-state">
        <ion-icon name="wine" color="medium"></ion-icon>
        <p>Aucune boisson configur√©e</p>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="circular"></ion-spinner>
    <p>Chargement des options...</p>
  </div>

</div>